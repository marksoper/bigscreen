## -*- coding: utf-8 -*-


<%def name="headScripts()">
 <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
  <script type="text/javascript">
    ${ jqueryReadyScripts() }
  </script>
</%def>

<%def name="jqueryReadyScripts()">
  % if page == "index":
    ${ showScript() }
  % endif
</%def>

<%def name="showScript()">
   var format = "json"
   var api_key = "ff4f40b52906a3fae2961e17739db037"
   var url = "http://api.flickr.com/services/rest/"
   var method = "flickr.photos.search"
   var user_id= "10938641@N05" 
   var tags = "show"
   var per_page = "500"
   $.get(url, {"method":method,"api_key":api_key,"format":format,"user_id":user_id,"tags":tags,"per_page":per_page},
       function(data) {
           data = data.replace(/^jsonFlickrApi\(/,'').replace(/\)$/,'');
           var res = jQuery.parseJSON(data);
           var photos = res.photos.photo;
           shuffle(photos);
           index = 0;
           nextPhoto(photos,index);
       });

    function nextPhoto(photos,index) {
        timer = setTimeout(function() {
            var photo_url = "http://farm" + photos[index].farm + ".static.flickr.com/" + photos[index].server + "/" + photos[index].id + "_" + photos[index].secret + "_b_d.jpg";
            var img = new Image();
            img.src = photo_url;
            ##alert(img.naturalWidth + 'x' + img.naturalHeight);
            $("#showImage").attr('src',img.src);
            index++;
            nextPhoto(photos,index);
        }, 7000);
    }

    function shuffle ( ls ) {
        var i = ls.length;
        if ( i == 0 ) return false;
        while ( --i ) {
           var j = Math.floor( Math.random() * ( i + 1 ) );
           var tempi = ls[i];
           var tempj = ls[j];
           ls[i] = tempj;
           ls[j] = tempi;
         }
}

</%def>


<%def name="bodyContent()" >
  <div class="bodyContent">
  % if page == "index":
    ${ show() }
  % elif page == "contact":
    ${ contact() }
  % elif page == "about":
    ${ about() }
  % endif
  ${ control() }
  </div>
</%def>


<%def name="indexCSS()" >
  ${ showCSS() }
</%def>


<%def name="show()" >
  <div class="show">
      <img src="http://farm6.static.flickr.com/5045/5310805170_5598b62004_b.jpg" class="showImage" id="showImage" />
  </div>
</%def>


<%def name="showCSS()" >
  .show {
    float:left;
    clear:left;
    background-color:#060606;
    width:1050px;
    height:700px;
  }
  .showImage {
    height:700px;
  }
</%def>

